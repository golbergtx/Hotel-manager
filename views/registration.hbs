<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport"
	      content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<link rel="stylesheet" href="/css/main.css">
	<link rel="stylesheet" href="/css/registration.css">
	<title>Registration</title>
</head>
<body>
{{>header}}
<section class="title-wrapper">
	<h1 class="title-text">Заселение</h1>
</section>
<article>
	<div class="filter-wrapper">
		<p class="filter-text">Фильтр:</p>
		<input type="text" placeholder="Имя гостя" v-model="guestNameFilter">
		<button class="open-popup-btn" @click="openRegistrationPopup">Оформить</button>
	</div>

	<table class="table-content-wrapper">
		<tr class="table-content-caption">
			<td>Номер комнаты</td>
			<td>Цена</td>
			<td>Дата заселения</td>
			<td>Дата выселения</td>
			<td>Метод оплаты</td>
			<td>Общая сумма</td>
			<td>Гость ID</td>
			<td>Удалить</td>
		</tr>
		<tr v-for="(registration, index) in displayedRegistrations">
			<td v-text="registration.roomNumber"></td>
			<td v-text="registration.getPrice()"></td>
			<td v-text="registration.getDateOfArrival()"></td>
			<td v-text="registration.getDateOfDeparture()"></td>
			<td v-text="registration.methodOfPayment"></td>
			<td v-text="registration.getSumPrice()"></td>
			<td v-text="registration.guestID"></td>
			<td>
				<button class="delete-registration-btn" @click="deleteRegistration(index)"></button>
			</td>
		</tr>
	</table>

	<div class="popup-overlay" v-show="openedRegistrationPopup"></div>
	<div class="popup" v-show="openedRegistrationPopup">
		<h3 class="popup-caption">Оформить регистрацию:</h3>
		<span class="popup-error-message" v-if="showPopupErrorMessage" v-text="popupErrorMessage"></span>
		<div class="popup-input-wrapper">
			<label for="">Номер</label>
			<select v-model="registration.roomNumber" @change="onChangeRoomNumber">
				<option v-for="(roomNumber) in freeRoomNumbers" v-text="roomNumber"></option>
			</select>
		</div>
		<div class="popup-input-wrapper">
			<label for="">Цена</label>
			<input type="text" readonly v-model="registration.price">
		</div>
		<div class="popup-input-wrapper">
			<label for="">Дата заселення</label>
			<input type="date" v-model="registration.dateOfArrival" @change="setSumPrice">
		</div>
		<div class="popup-input-wrapper">
			<label for="">Дата выселения</label>
			<input type="date" v-model="registration.dateOfDeparture" @change="setSumPrice">
		</div>
		<div class="popup-input-wrapper">
			<label for="">Метод оплаты</label>
			<select v-model="registration.methodOfPayment">
				<option v-for="(method) in methodsOfPayment" v-text="method"></option>
			</select>
		</div>
		<div class="popup-input-wrapper">
			<label for="">Гость</label>
			<select @change="onChangeGuestID">
				<option v-for="guest in guests" v-text="guest.getFullName()"></option>
			</select>
		</div>
		<div class="popup-input-wrapper">
			<label for="">Общая сумма</label>
			<input type="text" readonly v-model="registration.wholeAmount">
		</div>
		<div class="popup-footer">
			<button class="save-data-btn" :class="{disable: showPopupErrorMessage || !registration.paidStatus}"
			        @click="addRegistration">Подтвердить</button>
			<button class="save-data-btn" :class="{disable: showPopupErrorMessage}"
			        @click="openServicesPopup">Доп. услуги</button>
			<span class="approve-pay-text">Подтвердить оплату</span>
			<input type="checkbox" class="approve-pay-checkbox" v-model="registration.paidStatus">
		</div>
		<button class="close-popup-btn" @click="closeRegistrationPopup"></button>
	</div>

	<div class="popup-overlay" v-show="openedServicesPopup"></div>
	<div class="popup" v-show="openedServicesPopup">
		<h3 class="popup-caption">Дополнительные услуги:</h3>
		<div class="popup-input-wrapper">
			<label for="">Цена</label>
			<input type="number" v-model.number="registration.priceServices" @input="onChangePriceServices">
		</div>
		<div class="popup-input-wrapper">
			<label for="">Общая сумма</label>
			<input type="number" readonly v-model="registration.wholeAmount">
		</div>
		<button class="close-popup-btn" @click="closeServicesPopup"></button>
	</div>
</article>
{{>footer}}
<script src="/js/vue.js"></script>
<script type="module" src="/js/registration-page.js"></script>
</body>
</html>